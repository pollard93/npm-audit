import { formatVulnerability } from './formatVulnerability';
import { FilteredVulnerability } from '../../shared/types';
import { RESET_COLOR } from './severity';

describe('formatVulnerability', () => {
  it('should format a high severity vulnerability', () => {
    const vuln: FilteredVulnerability = {
      id: 123456,
      name: 'test-package',
      severity: 'high',
      title: 'Test vulnerability title',
      url: 'https://npmjs.com/advisories/123456',
    };

    const result = formatVulnerability(vuln);

    expect(result).toContain('HIGH');
    expect(result).toContain('test-package');
    expect(result).toContain('Test vulnerability title');
    expect(result).toContain('ID: 123456');
    expect(result).toContain('URL: https://npmjs.com/advisories/123456');
    expect(result).toContain(RESET_COLOR);
  });

  it('should format a critical severity vulnerability', () => {
    const vuln: FilteredVulnerability = {
      id: 789,
      name: 'critical-pkg',
      severity: 'critical',
      title: 'Critical security issue',
      url: 'https://npmjs.com/advisories/789',
    };

    const result = formatVulnerability(vuln);

    expect(result).toContain('CRITICAL');
    expect(result).toContain('critical-pkg');
  });

  it('should include proper indentation', () => {
    const vuln: FilteredVulnerability = {
      id: 123,
      name: 'test-pkg',
      severity: 'high',
      title: 'Test',
      url: 'https://example.com',
    };

    const result = formatVulnerability(vuln);
    const lines = result.split('\n');

    expect(lines[0]).toMatch(/^ {2}/);
    expect(lines[1]).toMatch(/^ {4}ID:/);
    expect(lines[2]).toMatch(/^ {4}URL:/);
  });
});
